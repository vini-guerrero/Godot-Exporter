name: Export
on:
  push:
    branches: [main]

env:
  EXPORT_NAME: game
  GODOT_VERSION: 3.3.1
  GODOT_DL_SUBDIR: 3.3.1
  GODOT_RELEASE: stable

jobs:
  export:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v1
      - name: Setup Dependencies
        working-directory: .
        run: |
          chmod +x ./setup.sh && sudo ./setup.sh
      - name: Prepare Export
        run: |
          wget https://downloads.tuxfamily.org/godotengine/${GODOT_DL_SUBDIR}/Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_linux_headless.64.zip \
          && wget https://downloads.tuxfamily.org/godotengine/${GODOT_DL_SUBDIR}/Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_export_templates.tpz \
          && mkdir -v ~/.cache \
          && mkdir -p -v ~/.config/godot \
          && mkdir -p -v ~/.local/share/godot/templates/${GODOT_VERSION}.${GODOT_RELEASE} \
          && unzip Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_linux_headless.64.zip \
          && sudo mv Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_linux_headless.64 /usr/local/bin/godot \
          && unzip Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_export_templates.tpz \
          && sudo mv templates/* ~/.local/share/godot/templates/${GODOT_VERSION}.${GODOT_RELEASE} \
          && sudo rm -f Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_export_templates.tpz Godot_v${GODOT_VERSION}-${GODOT_RELEASE}_linux_headless.64.zip
    # container:
    #   image: viiniiguerrero/godot_ci:latest
    # steps:
    #   - name: Checkout
    #     uses: actions/checkout@v1
    #   - name: Setup
    #     run: |
    #       mkdir -v -p ~/.local/share/godot/templates
    #       mv /root/.local/share/godot/templates/${GODOT_VERSION}.stable ~/.local/share/godot/templates/${GODOT_VERSION}.stable
    #       mkdir -v -p ~/.config/godot/
    #       cp /root/.config/godot/editor_settings-3.tres ~/.config/godot/editor_settings-3.tres
    #       echo 'export/android/debug_keystore = "/root/android-sdk/debug.keystore"' >> ~/.config/godot/editor_settings-3.tres
    #       echo 'export/android/android_sdk_path = "/root/android-sdk"' >> ~/.config/godot/editor_settings-3.tres
    #   - name: Android Debug Build
    #     run: |
    #       cd game
    #       mkdir -v -p build/android
    #       godot --verbose --export-debug "Android" ./build/android/$EXPORT_NAME.debug.apk
    #   - uses: actions/upload-artifact@v1
    #     with:
    #       name: android
    #       path: game/build/android
